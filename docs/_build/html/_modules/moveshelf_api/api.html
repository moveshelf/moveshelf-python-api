<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>moveshelf_api.api &#8212; moveshelf-api 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <script src="../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for moveshelf_api.api</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">struct</span>

<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">enum</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please install enum34 package&#39;</span><span class="p">)</span>
    <span class="k">raise</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">from</span> <span class="nn">crcmod.predefined</span> <span class="kn">import</span> <span class="n">mkPredefinedCrcFun</span>
<span class="kn">from</span> <span class="nn">mypy_extensions</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;moveshelf-api&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="TimecodeFramerate">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.TimecodeFramerate">[docs]</a>
<span class="k">class</span> <span class="nc">TimecodeFramerate</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">FPS_24</span> <span class="o">=</span> <span class="s1">&#39;24&#39;</span>
    <span class="n">FPS_25</span> <span class="o">=</span> <span class="s1">&#39;25&#39;</span>
    <span class="n">FPS_29_97</span> <span class="o">=</span> <span class="s1">&#39;29.97&#39;</span>
    <span class="n">FPS_30</span> <span class="o">=</span> <span class="s1">&#39;30&#39;</span>
    <span class="n">FPS_50</span> <span class="o">=</span> <span class="s1">&#39;50&#39;</span>
    <span class="n">FPS_59_94</span> <span class="o">=</span> <span class="s1">&#39;59.94&#39;</span>
    <span class="n">FPS_60</span> <span class="o">=</span> <span class="s1">&#39;60&#39;</span>
    <span class="n">FPS_1000</span> <span class="o">=</span> <span class="s1">&#39;1000&#39;</span></div>



<span class="n">Timecode</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s1">&#39;Timecode&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;timecode&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s1">&#39;framerate&#39;</span><span class="p">:</span> <span class="n">TimecodeFramerate</span>
    <span class="p">})</span>


<span class="n">Metadata</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s1">&#39;Metadata&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s1">&#39;previewImageUri&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s1">&#39;allowDownload&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="s1">&#39;allowUnlistedAccess&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="s1">&#39;startTimecode&#39;</span><span class="p">:</span> <span class="n">Timecode</span>
    <span class="p">},</span>
    <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<div class="viewcode-block" id="MoveshelfApi">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi">[docs]</a>
<span class="k">class</span> <span class="nc">MoveshelfApi</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key_file</span><span class="o">=</span><span class="s1">&#39;mvshlf-api-key.json&#39;</span><span class="p">,</span> <span class="n">api_url</span> <span class="o">=</span> <span class="s1">&#39;https://api.moveshelf.com/graphql&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_crc32c</span> <span class="o">=</span> <span class="n">mkPredefinedCrcFun</span><span class="p">(</span><span class="s1">&#39;crc32c&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_url</span> <span class="o">=</span> <span class="n">api_url</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">api_key_file</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No valid API key. Please check instructions on https://github.com/moveshelf/python-api-example&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">api_key_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">key_file</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">key_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_auth_token</span> <span class="o">=</span> <span class="n">BearerTokenAuth</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;secretKey&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="MoveshelfApi.getProjectDatasets">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.getProjectDatasets">[docs]</a>
    <span class="k">def</span> <span class="nf">getProjectDatasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            query getProjectDatasets($projectId: ID!) {</span>
<span class="sd">            node(id: $projectId) {</span>
<span class="sd">                ... on Project {</span>
<span class="sd">                id,</span>
<span class="sd">                name,</span>
<span class="sd">                datasets {</span>
<span class="sd">                    name,</span>
<span class="sd">                    downloadUri</span>
<span class="sd">                }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">projectId</span> <span class="o">=</span> <span class="n">project_id</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">][</span><span class="s1">&#39;datasets&#39;</span><span class="p">]]</span></div>


<div class="viewcode-block" id="MoveshelfApi.getUserProjects">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.getUserProjects">[docs]</a>
    <span class="k">def</span> <span class="nf">getUserProjects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            query {</span>
<span class="sd">                viewer {</span>
<span class="sd">                    projects {</span>
<span class="sd">                        name</span>
<span class="sd">                        id</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;viewer&#39;</span><span class="p">][</span><span class="s1">&#39;projects&#39;</span><span class="p">]]</span></div>


<div class="viewcode-block" id="MoveshelfApi.createClip">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.createClip">[docs]</a>
    <span class="k">def</span> <span class="nf">createClip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">Metadata</span><span class="p">()</span> <span class="p">):</span>
        <span class="n">creation_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createClip</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;clientId&#39;</span><span class="p">:</span> <span class="s1">&#39;manual&#39;</span><span class="p">,</span>
            <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="n">metadata</span>
        <span class="p">})</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Created clip ID: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">creation_response</span><span class="p">[</span><span class="s1">&#39;mocapClip&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">creation_response</span><span class="p">[</span><span class="s1">&#39;mocapClip&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoveshelfApi.uploadFile">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.uploadFile">[docs]</a>
    <span class="k">def</span> <span class="nf">uploadFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">Metadata</span><span class="p">()):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Uploading </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>

        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;allowDownload&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;allowDownload&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;allowUnlistedAccess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;allowUnlistedAccess&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;startTimecode&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validateAndUpdateTimecode</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;startTimecode&#39;</span><span class="p">])</span>

        <span class="n">creation_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createClip</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;clientId&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
            <span class="s1">&#39;crc32c&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculateCrc32c</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
            <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
            <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="n">metadata</span>
        <span class="p">})</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Created clip ID: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">creation_response</span><span class="p">[</span><span class="s1">&#39;mocapClip&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">creation_response</span><span class="p">[</span><span class="s1">&#39;uploadUrl&#39;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">creation_response</span><span class="p">[</span><span class="s1">&#39;mocapClip&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoveshelfApi.uploadAdditionalData">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.uploadAdditionalData">[docs]</a>
    <span class="k">def</span> <span class="nf">uploadAdditionalData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">clipId</span><span class="p">,</span> <span class="n">dataType</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Uploading </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>

        <span class="n">creation_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createAdditionalData</span><span class="p">(</span><span class="n">clipId</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;clientId&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
            <span class="s1">&#39;crc32c&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculateCrc32c</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
            <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
            <span class="s1">&#39;dataType&#39;</span><span class="p">:</span> <span class="n">dataType</span>
        <span class="p">})</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Created clip ID: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">creation_response</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">creation_response</span><span class="p">[</span><span class="s1">&#39;uploadUrl&#39;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">creation_response</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoveshelfApi.updateClipMetadata">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.updateClipMetadata">[docs]</a>
    <span class="k">def</span> <span class="nf">updateClipMetadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Updating metadata for clip: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;startTimecode&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validateAndUpdateTimecode</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;startTimecode&#39;</span><span class="p">])</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            mutation updateClip($input: UpdateClipInput!) {</span>
<span class="sd">                updateClip(clipData: $input) {</span>
<span class="sd">                    clip {</span>
<span class="sd">                        id</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">clip_id</span><span class="p">,</span>
                <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="n">metadata</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Updated clip ID: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="s1">&#39;updateClip&#39;</span><span class="p">][</span><span class="s1">&#39;clip&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="MoveshelfApi.createSubject">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.createSubject">[docs]</a>
    <span class="k">def</span> <span class="nf">createSubject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                mutation createPatientMutation($projectId: String!, $name: String!) {</span>
<span class="sd">                    createPatient(projectId: $projectId, name: $name) {</span>
<span class="sd">                        patient {</span>
<span class="sd">                            id</span>
<span class="sd">                            name</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">projectId</span> <span class="o">=</span> <span class="n">project_id</span><span class="p">,</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;createPatient&#39;</span><span class="p">][</span><span class="s1">&#39;patient&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoveshelfApi.updateSubjectMetadataInfo">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.updateSubjectMetadataInfo">[docs]</a>
    <span class="k">def</span> <span class="nf">updateSubjectMetadataInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject_id</span><span class="p">,</span> <span class="n">info_to_save</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                mutation updatePatientMutation($patientId: ID!, $metadata: JSONString) {</span>
<span class="sd">                    updatePatient(patientId: $patientId, metadata: $metadata) {</span>
<span class="sd">                        updated</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">patientId</span> <span class="o">=</span> <span class="n">subject_id</span><span class="p">,</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">info_to_save</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;updatePatient&#39;</span><span class="p">][</span><span class="s1">&#39;updated&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoveshelfApi.getsubjectContext">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.getsubjectContext">[docs]</a>
    <span class="k">def</span> <span class="nf">getsubjectContext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject_id</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                query getPatientContext($patientId: ID!) {</span>
<span class="sd">                    node(id: $patientId) {</span>
<span class="sd">                        ... on Patient {</span>
<span class="sd">                            id,</span>
<span class="sd">                            name,</span>
<span class="sd">                            metadata,</span>
<span class="sd">                            project {</span>
<span class="sd">                                id</span>
<span class="sd">                                description</span>
<span class="sd">                                canEdit</span>
<span class="sd">                                unlistedAccess</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">patientId</span> <span class="o">=</span> <span class="n">subject_id</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoveshelfApi.createSession">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.createSession">[docs]</a>
    <span class="k">def</span> <span class="nf">createSession</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">session_path</span><span class="p">,</span> <span class="n">subject_id</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">                mutation createSessionMutation($projectId: String!, $projectPath: String!, $patientId: ID!) {</span>
<span class="sd">                    createSession(projectId: $projectId, projectPath: $projectPath, patientId: $patientId) {</span>
<span class="sd">                        session {</span>
<span class="sd">                            id</span>
<span class="sd">                            projectPath</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">projectId</span> <span class="o">=</span> <span class="n">project_id</span><span class="p">,</span>
            <span class="n">projectPath</span> <span class="o">=</span> <span class="n">session_path</span><span class="p">,</span>
            <span class="n">patientId</span> <span class="o">=</span> <span class="n">subject_id</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;createSession&#39;</span><span class="p">][</span><span class="s1">&#39;session&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoveshelfApi.getProjectClips">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.getProjectClips">[docs]</a>
    <span class="k">def</span> <span class="nf">getProjectClips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">include_download_link</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            query getAdditionalDataInfo($projectId: ID!, $limit: Int) {</span>
<span class="s1">            node(id: $projectId) {</span>
<span class="s1">                ... on Project {</span>
<span class="s1">                id,</span>
<span class="s1">                name,</span>
<span class="s1">                clips(first: $limit) {</span>
<span class="s1">                edges {</span>
<span class="s1">                    node {</span>
<span class="s1">                        id,</span>
<span class="s1">                        title,</span>
<span class="s1">                        projectPath</span>
<span class="s1">                    }</span>
<span class="s1">                    }</span>
<span class="s1">                }</span>
<span class="s1">                }</span>
<span class="s1">            }</span>
<span class="s1">            }</span>
<span class="s1">            &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">include_download_link</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                query getAdditionalDataInfo($projectId: ID!, $limit: Int) {</span>
<span class="s1">                node(id: $projectId) {</span>
<span class="s1">                    ... on Project {</span>
<span class="s1">                    id,</span>
<span class="s1">                    name,</span>
<span class="s1">                    clips(first: $limit) {</span>
<span class="s1">                    edges {</span>
<span class="s1">                        node {</span>
<span class="s1">                            id,</span>
<span class="s1">                            title,</span>
<span class="s1">                            projectPath</span>
<span class="s1">                            originalFileName</span>
<span class="s1">                            originalDataDownloadUri</span>
<span class="s1">                        }</span>
<span class="s1">                        }</span>
<span class="s1">                    }</span>
<span class="s1">                    }</span>
<span class="s1">                }</span>
<span class="s1">                }</span>
<span class="s1">                &#39;&#39;&#39;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
            <span class="n">query</span><span class="p">,</span>
            <span class="n">projectId</span> <span class="o">=</span> <span class="n">project_id</span><span class="p">,</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">][</span><span class="s1">&#39;clips&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">]]</span></div>


<div class="viewcode-block" id="MoveshelfApi.getAdditionalData">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.getAdditionalData">[docs]</a>
    <span class="k">def</span> <span class="nf">getAdditionalData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            query getAdditionalDataInfo($clipId: ID!) {</span>
<span class="sd">            node(id: $clipId) {</span>
<span class="sd">                ... on MocapClip {</span>
<span class="sd">                id,</span>
<span class="sd">                additionalData {</span>
<span class="sd">                    id</span>
<span class="sd">                    dataType</span>
<span class="sd">                    uploadStatus</span>
<span class="sd">                    originalFileName</span>
<span class="sd">                    previewDataUri</span>
<span class="sd">                    originalDataDownloadUri</span>
<span class="sd">                }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">clipId</span> <span class="o">=</span> <span class="n">clip_id</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">][</span><span class="s1">&#39;additionalData&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoveshelfApi.getClipData">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.getClipData">[docs]</a>
    <span class="k">def</span> <span class="nf">getClipData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            query getClipInfo($clipId: ID!) {</span>
<span class="sd">            node(id: $clipId) {</span>
<span class="sd">                ... on MocapClip {</span>
<span class="sd">                id,</span>
<span class="sd">                title,</span>
<span class="sd">                description</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">clipId</span> <span class="o">=</span> <span class="n">clip_id</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoveshelfApi.getProjectAndClips">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.getProjectAndClips">[docs]</a>
    <span class="k">def</span> <span class="nf">getProjectAndClips</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            query {</span>
<span class="sd">                viewer {</span>
<span class="sd">                    projects {</span>
<span class="sd">                        id</span>
<span class="sd">                        name</span>
<span class="sd">                        clips(first: 20) {</span>
<span class="sd">                            edges {</span>
<span class="sd">                                node {</span>
<span class="sd">                                    id,</span>
<span class="sd">                                    title</span>
<span class="sd">                                    }</span>
<span class="sd">                                }</span>
<span class="sd">                            }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;viewer&#39;</span><span class="p">][</span><span class="s1">&#39;projects&#39;</span><span class="p">]]</span></div>


<div class="viewcode-block" id="MoveshelfApi.getProjectSubjects">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.getProjectSubjects">[docs]</a>
    <span class="k">def</span> <span class="nf">getProjectSubjects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_id</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            query getProjectPatients($projectId: ID!) {</span>
<span class="sd">                node(id: $projectId) {</span>
<span class="sd">                    ... on Project {</span>
<span class="sd">                        id,</span>
<span class="sd">                        name,</span>
<span class="sd">                        description,</span>
<span class="sd">                        canEdit,</span>
<span class="sd">                        patients {</span>
<span class="sd">                            id</span>
<span class="sd">                            name</span>
<span class="sd">                            metadata</span>
<span class="sd">                        }</span>
<span class="sd">                        sessions {</span>
<span class="sd">                            id</span>
<span class="sd">                            projectPath</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">projectId</span> <span class="o">=</span> <span class="n">project_id</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">][</span><span class="s1">&#39;patients&#39;</span><span class="p">]]</span></div>


<div class="viewcode-block" id="MoveshelfApi.getSubjectDetails">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.getSubjectDetails">[docs]</a>
    <span class="k">def</span> <span class="nf">getSubjectDetails</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject_id</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            query getPatient($patientId: ID!) {</span>
<span class="sd">                node(id: $patientId) {</span>
<span class="sd">                    ... on Patient {</span>
<span class="sd">                        id,</span>
<span class="sd">                        name,</span>
<span class="sd">                        metadata,</span>
<span class="sd">                        project {</span>
<span class="sd">                            id</span>
<span class="sd">                        }</span>
<span class="sd">                        reports {</span>
<span class="sd">                            id</span>
<span class="sd">                            title</span>
<span class="sd">                        }</span>
<span class="sd">                        sessions {</span>
<span class="sd">                            id</span>
<span class="sd">                            projectPath</span>
<span class="sd">                            clips {</span>
<span class="sd">                                id</span>
<span class="sd">                                title</span>
<span class="sd">                                created</span>
<span class="sd">                                projectPath</span>
<span class="sd">                                uploadStatus</span>
<span class="sd">                                hasCharts</span>
<span class="sd">                            }</span>
<span class="sd">                            norms {</span>
<span class="sd">                                id</span>
<span class="sd">                                name</span>
<span class="sd">                                uploadStatus</span>
<span class="sd">                                projectPath</span>
<span class="sd">                                clips {</span>
<span class="sd">                                    id</span>
<span class="sd">                                    title</span>
<span class="sd">                                }</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">patientId</span> <span class="o">=</span> <span class="n">subject_id</span>
        <span class="p">)</span>
        <span class="c1"># return {k:v for k,v in data[&#39;node&#39;].items() if k in [&#39;name&#39;,&#39;id&#39;]}</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoveshelfApi.processGaitTool">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.processGaitTool">[docs]</a>
    <span class="k">def</span> <span class="nf">processGaitTool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clip_ids</span><span class="p">,</span> <span class="n">trial_type</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            mutation processGaitTool($clips: [String!], $trialType: String) {</span>
<span class="sd">                processGaitTool(clips: $clips, trialType: $trialType) {</span>
<span class="sd">                    jobId</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">clips</span> <span class="o">=</span> <span class="n">clip_ids</span><span class="p">,</span>
            <span class="n">trialType</span> <span class="o">=</span> <span class="n">trial_type</span>

        <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;processGaitTool&#39;</span><span class="p">][</span><span class="s1">&#39;jobId&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoveshelfApi.getJobStatus">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.getJobStatus">[docs]</a>
    <span class="k">def</span> <span class="nf">getJobStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            query jobStatus($jobId: ID!) {</span>
<span class="sd">                node(id: $jobId) {</span>
<span class="sd">                    ... on Job {</span>
<span class="sd">                        id,</span>
<span class="sd">                        status,</span>
<span class="sd">                        result,</span>
<span class="sd">                        description</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">jobId</span> <span class="o">=</span> <span class="n">job_id</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MoveshelfApi.getSessionById">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.MoveshelfApi.getSessionById">[docs]</a>
    <span class="k">def</span> <span class="nf">getSessionById</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            query getSession($sessionId: ID!) {</span>
<span class="sd">                node(id: $sessionId) {</span>
<span class="sd">                    ... on Session {</span>
<span class="sd">                        id,</span>
<span class="sd">                        projectPath,</span>
<span class="sd">                        metadata,</span>
<span class="sd">                        project {</span>
<span class="sd">                            id</span>
<span class="sd">                            name</span>
<span class="sd">                            canEdit</span>
<span class="sd">                        }</span>
<span class="sd">                        clips {</span>
<span class="sd">                            id</span>
<span class="sd">                            title</span>
<span class="sd">                            created</span>
<span class="sd">                            projectPath</span>
<span class="sd">                            uploadStatus</span>
<span class="sd">                            hasCharts</span>
<span class="sd">                            hasVideo</span>
<span class="sd">                        }</span>
<span class="sd">                        norms {</span>
<span class="sd">                            id</span>
<span class="sd">                            name</span>
<span class="sd">                            uploadStatus</span>
<span class="sd">                            projectPath</span>
<span class="sd">                            clips {</span>
<span class="sd">                                id</span>
<span class="sd">                                title</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                        patient {</span>
<span class="sd">                        id</span>
<span class="sd">                        name</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="n">sessionId</span> <span class="o">=</span> <span class="n">session_id</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span></div>



    <span class="k">def</span> <span class="nf">_validateAndUpdateTimecode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">tc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timecode&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">tc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;framerate&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tc</span><span class="p">[</span><span class="s1">&#39;framerate&#39;</span><span class="p">],</span> <span class="n">TimecodeFramerate</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;\d</span><span class="si">{2}</span><span class="s1">:\d</span><span class="si">{2}</span><span class="s1">:\d</span><span class="si">{2}</span><span class="s1">[:;]\d{2,3}&#39;</span><span class="p">,</span> <span class="n">tc</span><span class="p">[</span><span class="s1">&#39;timecode&#39;</span><span class="p">])</span>
        <span class="n">tc</span><span class="p">[</span><span class="s1">&#39;framerate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tc</span><span class="p">[</span><span class="s1">&#39;framerate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">_createClip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">clip_creation_data</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            mutation createClip($input: ClipCreationInput!) {</span>
<span class="sd">                createClips(input: $input) {</span>
<span class="sd">                    response {</span>
<span class="sd">                        clientId,</span>
<span class="sd">                        uploadUrl,</span>
<span class="sd">                        mocapClip {</span>
<span class="sd">                            id</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;project&#39;</span><span class="p">:</span> <span class="n">project</span><span class="p">,</span>
                <span class="s1">&#39;clips&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">clip_creation_data</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;createClips&#39;</span><span class="p">][</span><span class="s1">&#39;response&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_calculateCrc32c</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">crc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_crc32c</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">b64_crc</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&gt;I&#39;</span><span class="p">,</span> <span class="n">crc</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">b64_crc</span> <span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span> <span class="k">else</span> <span class="n">b64_crc</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_createAdditionalData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clipId</span><span class="p">,</span> <span class="n">metadata</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_graphql</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            mutation createAdditionalData($input: CreateAdditionalDataInput) {</span>
<span class="sd">                createAdditionalData(input: $input) {</span>
<span class="sd">                uploadUrl</span>
<span class="sd">                data {</span>
<span class="sd">                    id</span>
<span class="sd">                    dataType</span>
<span class="sd">                    originalFileName</span>
<span class="sd">                    uploadStatus</span>
<span class="sd">                }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">            &#39;&#39;&#39;</span><span class="p">,</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;clipId&#39;</span><span class="p">:</span> <span class="n">clipId</span><span class="p">,</span>
                <span class="s1">&#39;dataType&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;dataType&#39;</span><span class="p">],</span>
                <span class="s1">&#39;crc32c&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;crc32c&#39;</span><span class="p">],</span>
                <span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span>
                <span class="s1">&#39;clientId&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;clientId&#39;</span><span class="p">]</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;createAdditionalData&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_dispatch_graphql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
            <span class="s1">&#39;variables&#39;</span><span class="p">:</span> <span class="n">kwargs</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_auth_token</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="n">json_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;errors&#39;</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GraphQlException</span><span class="p">(</span><span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">json_data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span></div>



<div class="viewcode-block" id="BearerTokenAuth">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.BearerTokenAuth">[docs]</a>
<span class="k">class</span> <span class="nc">BearerTokenAuth</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">AuthBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span> <span class="o">=</span> <span class="s1">&#39;Bearer </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span>
        <span class="k">return</span> <span class="n">request</span></div>



<div class="viewcode-block" id="GraphQlException">
<a class="viewcode-back" href="../../moveshelf_api.html#moveshelf_api.api.GraphQlException">[docs]</a>
<span class="k">class</span> <span class="nc">GraphQlException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_info</span> <span class="o">=</span> <span class="n">error_info</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">moveshelf-api</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">moveshelf_api</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Moveshelf.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>